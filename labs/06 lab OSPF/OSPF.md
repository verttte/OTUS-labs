#### Схема лабораторного стенда

![image](https://github.com/verttte/otus-labs/assets/165086553/acf4e398-1b4a-483b-9ceb-eea317737a64)

#### 1. Маршрутизаторы R14-R15 находятся в зоне 0 - backbone.

Включаем работу протокола OSPF на R14  
```
router ospf 1
 router-id 10.10.50.14
 network 10.10.50.14 0.0.0.0 area 0
 network 10.10.200.0 0.0.0.255 area 0
```

Указываем на порту в сторону R15 принадлежность к area 0  
```
interface Ethernet1/0
 description R15
 ip address 10.10.200.26 255.255.255.252
 ip ospf 1 area 0
!
```

Включаем работу протокола OSPF на R15  
```
router ospf 1
 router-id 10.10.50.15
 network 10.10.50.15 0.0.0.0 area 0
 network 10.10.200.0 0.0.0.255 area 0
```

Указываем на порту в сторону R14 принадлежность к area 0  
```
interface Ethernet1/0
 description R14
 ip address 10.10.200.25 255.255.255.252
 ip ospf 1 area 0
!
```

#### 2. Маршрутизаторы R12-R13 находятся в зоне 10. Дополнительно к маршрутам должны получать маршрут по умолчанию.

R14 и R15 явлюятся ABR маршрутизаторами, поэтому на них обозначается граница зоны 10.  
Настраиваем линки в сторону R12-R13 на R14  
```
interface Ethernet0/0
 description R12
 ip address 10.10.200.5 255.255.255.252
 ip ospf 1 area 10
!
interface Ethernet0/1
 description R13
 ip address 10.10.200.9 255.255.255.252
 ip ospf 1 area 10
!
```

Настраиваем линки в сторону R12-R13 на R15  
```
interface Ethernet0/0
 description R13
 ip address 10.10.200.17 255.255.255.252
 ip ospf 1 area 10
!
interface Ethernet0/1
 description R12
 ip address 10.10.200.13 255.255.255.252
 ip ospf 1 area 10
!
```

Маршрутизаторы R12-R13 оба находятся в area 10. Поэтому на них нет необходимости настраивать линки, только процесс OSPF.  
```
router ospf 1
 router-id 10.10.50.12
 network 10.10.50.12 0.0.0.0 area 10
 network 10.10.200.0 0.0.0.255 area 10
```

```
router ospf 1
 router-id 10.10.50.13
 network 10.10.50.13 0.0.0.0 area 10
 network 10.10.200.0 0.0.0.255 area 10
```

Для того, чтоб передать маршрут по умолчанию в area 10, его надо настроить на  R14 и R15 и задать соответствующую команду в настройках OSPF.  
На R14 прописываем маршрут по умолчанию в сторону R22, Киторн.  
```
ip route 0.0.0.0 0.0.0.0 10.10.100.1
```

На R15 прописываем маршрут по умолчанию в сторону R21, Ламас.
```
ip route 0.0.0.0 0.0.0.0 10.10.100.5
```

Затем на R14 и R15 в настройках OSPF указываем команду передачи маршрута по умолчанию.  
```
router ospf 1
default-information originate
```

Видим, что в таблице маршрутизации, помимо прочих маршрутов, переданных по OSPF, появился маршрут по умолчанию.
```
R12#sh ip route

Gateway of last resort is 10.10.200.13 to network 0.0.0.0

O*E2  0.0.0.0/0 [110/1] via 10.10.200.13, 03:30:08, Ethernet0/3
                [110/1] via 10.10.200.5, 02:07:23, Ethernet0/2
```

```
R13#sh ip route

Gateway of last resort is 10.10.200.17 to network 0.0.0.0

O*E2  0.0.0.0/0 [110/1] via 10.10.200.17, 03:31:31, Ethernet0/2
                [110/1] via 10.10.200.9, 02:08:41, Ethernet0/3
```


#### 3. Маршрутизатор R19 находится в зоне 101 и получает только маршрут по умолчанию.

На R14 обозначаем границу зоны, настраиваем интерфейс в сторону R19  
```
interface Ethernet0/3
 description R19
 ip address 10.10.200.1 255.255.255.252
 ip ospf 1 area 101
!
```

Указываем в настройках OSPF соответствующий тип зоны, при котором будет передаваться маршрут по умолчанию, а остальная информация о маршрутах - нет.  
```
router ospf 1
 area 101 stub no-summary
```

Настраиваем OSPF на R19 и указываем аналогичный тип зоны.  

```
router ospf 1
 router-id 10.10.50.19
 area 101 stub no-summary
 network 10.10.50.19 0.0.0.0 area 101
 network 10.10.200.0 0.0.0.255 area 101
!
```

Проверяем, видим единственный маршрут переданный через OSPF - маршрут по умолчанию.  
```
R19#sh ip route ospf

Gateway of last resort is 10.10.200.1 to network 0.0.0.0

O*IA  0.0.0.0/0 [110/11] via 10.10.200.1, 02:24:13, Ethernet0/0
R19#
```

#### 4. Маршрутизатор R20 находится в зоне 102 и получает все маршруты, кроме маршрутов до сетей зоны 101.

На R15 обозначаем границу зоны, настраиваем интерфейс в сторону R20  
```
interface Ethernet0/3
 description R20
 ip address 10.10.200.21 255.255.255.252
 ip ospf 1 area 102
!
```

Настраиваем OSPF на R20  
```
router ospf 1
 router-id 10.10.50.20
 network 10.10.50.20 0.0.0.0 area 102
 network 10.10.200.0 0.0.0.255 area 102
!
```

Для того, чтоб не получать нежеланные маршруты необходимо настроить фильтрацию на ABR - R15.  
Создаем префикс-лист, который запрещает сети, которые присутствуют в зоне 101. В  конце правило, разрешающее все остальные сети.  
```
ip prefix-list AREA_102_IN seq 10 deny 10.10.50.19/32
ip prefix-list AREA_102_IN seq 20 deny 10.10.200.0/30
ip prefix-list AREA_102_IN seq 100 permit 0.0.0.0/0 le 32
!
```

Настраиваем применение фильтра на основе префикс-листа для area 102. Направление - на вход в зону.

```
router ospf 1
 area 102 filter-list prefix AREA_102_IN in
```

Ниже вывод команды просмотра маршрутов, переданных через OSPF до применения фильтра и после. Видим, что пропали фильтруемые подсети.

![image](https://github.com/verttte/otus-labs/assets/165086553/aeb420d8-86b8-4d8c-a3b6-a141d8dd8e45)


